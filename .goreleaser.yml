project_name: sealos
#gomod:
#  # Proxy a module from proxy.golang.org, making the builds verifiable.
#  # This will only be effective if running against a tag. Snapshots will ignore this setting.
#  # Notice: for this to work your `build.main` must be a package, not a `.go` file.
#  #
#  # Default is false.
#  proxy: true
#
#  # If proxy is true, use these environment variables when running `go mod` commands (namely, `go mod tidy`).
#  # Defaults to `os.Environ()`.
#  env:
#    - GOPROXY=https://goproxy.cn

before:
  hooks:
    - make clean
    - go mod tidy
builds:
  - id: sealos
    env:
      - CGO_ENABLED=1
      - CC=aarch64-linux-gnu-gcc
    main: ./cmd/sealos
    binary: sealos
    hooks:
      post: upx "{{ .Path }}"
    goos:
      - linux
    goarch:
      - arm64
      - amd64
    flags:
      - -trimpath
    tags:
      - containers_image_openpgp
      - netgo
      - exclude_graphdriver_devicemapper
      - static
      - osusergo
      - exclude_graphdriver_btrfs
    ldflags:
      - -X github.com/labring/sealos/pkg/version.gitVersion={{.Version}}
      - -X github.com/labring/sealos/pkg/version.gitCommit={{.ShortCommit}}
      - -X github.com/labring/sealos/pkg/version.buildDate={{.Date}}
      - -s -w
    overrides:
      - goos: linux
        goarch: amd64
        goamd64: v1
        goarm: ""
        gomips: ""
        env:
          - CGO_ENABLED=1
          - CC=x86_64-linux-gnu-gcc



release:
  #  github:
  #    name: sealos
  prerelease: auto



nfpms:
  - id: packages
    builds:
      - sealos
    vendor: labring
    homepage: https://github.com/labring/sealos
    maintainer: fanux (https://github.com/fanux)
    description: Cloud OS distribution with Kubernetes as kernel
    license: Apache 2.0
    formats:
      - deb
      - rpm

archives:
  - id: archive

checksum:
  name_template: "{{ .ProjectName }}_checksums.txt"
  algorithm: sha256
  ids:
    - archive

snapshot:
  name_template: "{{ .Tag }}-next"